<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Privacy Analysis Results</title>
    <style>
        body { font-family: sans-serif; margin: 20px; background-color: #f4f4f4; color: #333; }
        .container { background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        h1, h2, h3 { color: #333; }
        .policy-text { background-color: #e9e9e9; padding: 15px; border-radius: 4px; margin-bottom: 20px; white-space: pre-wrap; font-family: monospace; max-height: 200px; overflow-y: auto; border: 1px solid #ddd;}
        .sentence-block { margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 4px; background-color: #f9f9f9; }
        .sentence-text { font-style: italic; color: #555; margin-bottom: 10px; }
        .ai-category { font-weight: bold; color: #0056b3; margin-bottom: 10px; }
        .plain-summary { color: #444; margin-bottom: 10px; background-color: #f0f0f0; padding: 8px; border-radius: 3px; }
        .concern-level-text { font-weight: bold; margin-bottom: 10px; }
        .keyword-match { margin-left: 20px; padding: 10px; border-left: 3px solid #007bff; background-color: #e7f3ff; margin-bottom: 5px; border-radius: 4px; }
        .keyword-match p { margin: 5px 0; }
        /* Concern level styling */
        .concern-high { border-left: 5px solid red !important; background-color: #ffe0e0 !important; }
        .concern-medium { border-left: 5px solid orange !important; background-color: #fff0e0 !important; }
        .concern-low { border-left: 5px solid #77cc77 !important; background-color: #e0ffe0 !important; }
        .concern-none { border-left: 5px solid #eee !important; } /* Default if no specific concern but still a block */
        .no-results { color: #777; }
        a { color: #007bff; text-decoration: none; }
        a:hover { text-decoration: underline; }
        .back-link { display: inline-block; margin-top: 20px; padding: 10px 15px; background-color: #5bc0de; color: white; text-decoration: none; border-radius: 4px; }
        .back-link:hover { background-color: #46b8da; }
        .note { color: orange; margin-top: 20px; font-size: 0.9em; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Analysis Results</h1>

        <h2>Original Policy Text:</h2>
        <div class="policy-text">{{ policy_text if policy_text else "No text submitted." }}</div>

        <h2>Detailed Analysis:</h2>
        {% if analysis_results %}
            {% for sentence_analysis in analysis_results %}
                <div class="sentence-block concern-{{ sentence_analysis.user_concern_level | lower }}">
                    <p class="sentence-text"><strong>Sentence:</strong> {{ sentence_analysis.clause_text }}</p>
                    <p class="ai-category">AI Predicted Category: {{ sentence_analysis.ai_category }}</p>
                    <p class="plain-summary"><strong>Plain Language Summary:</strong> {{ sentence_analysis.plain_language_summary }}</p>
                    <p class="concern-level-text"><strong>Concern Level:</strong> {{ sentence_analysis.user_concern_level }}</p>

                    {% if sentence_analysis.keyword_matches %}
                        <p><strong>Keyword Matches in this sentence:</strong></p>
                        {% for match in sentence_analysis.keyword_matches %}
                            <div class="keyword-match">
                                <p><strong>Keyword:</strong> {{ match.keyword }}</p>
                                <p><strong>Original Category:</strong> {{ match.category }}</p>
                                <p><strong>Explanation:</strong> {{ match.explanation }}</p>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p><em>No specific keywords flagged in this sentence by the keyword scanner.</em></p>
                    {% endif %}
                </div>
            {% endfor %}
        {% else %}
            <p class="no-results">No analysis results to display. Input might have been empty or no clauses were processed.</p>
        {% endif %}

        {% if not nlp_available %}
            <p class="note"><strong>Note:</strong> The spaCy NLP model (en_core_web_sm) was not available when the server started. Sentence segmentation and AI categorization quality might be affected or disabled. Keyword spotting might still work based on simpler rules if implemented as a fallback in the interpreter.</p>
        {% endif %}

        <a href="{{ url_for('index') }}" class="back-link">&larr; Analyze another policy</a>
    </div>
</body>
</html>
